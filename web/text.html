<!doctype html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ByteFlusher — Text Flush (BLE to USB HID automatic typing)</title>
    <meta
      name="description"
      content="ByteFlusher Text Flush: Web Bluetooth(BLE)로 텍스트를 전송하면 nRF52840 보드가 USB HID 키보드 입력으로 Target PC에 정확하게 타이핑합니다. 정확성 우선(누락/중복 방지, Pause/Stop 즉시성)."
    />

    <link rel="icon" href="../favicon.svg" type="image/svg+xml" />
    <link rel="icon" href="../favicon.svg" sizes="any" />

    <link rel="canonical" href="https://aidanpark.github.io/byteflusher/web/text.html" />

    <meta property="og:type" content="website" />
    <meta property="og:locale" content="ko_KR" />
    <meta property="og:site_name" content="ByteFlusher" />
    <meta property="og:title" content="ByteFlusher — Text Flush" />
    <meta
      property="og:description"
      content="Web Bluetooth(BLE)로 텍스트 전송 → USB HID 키보드로 Target PC에 자동 타이핑(정확성 우선)."
    />
    <meta property="og:url" content="https://aidanpark.github.io/byteflusher/web/text.html" />
    <meta property="og:image" content="https://aidanpark.github.io/byteflusher/docs/ui_text_preview.png" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="ByteFlusher — Text Flush" />
    <meta
      name="twitter:description"
      content="BLE(Web Bluetooth) → nRF52840 → USB HID keyboard. 정확성 우선 텍스트 자동 입력."
    />
    <meta name="twitter:image" content="https://aidanpark.github.io/byteflusher/docs/ui_text_preview.png" />

    <link rel="stylesheet" href="./style.css" />
  </head>
  <body>
    <main class="container">
      <header class="topHeader">
        <h1><a href="../index.html" style="color: inherit; text-decoration: none;">🤖 Byte Flusher - Text 📄</a></h1>
        <p class="muted" style="margin-top: 8px; font-size: 14px; line-height: 1.5;">
          <a href="../index.html" style="color: inherit;">Home</a>
          · <a href="./files.html" style="color: inherit;">File Flush</a>
          · <a href="../docs/" style="color: inherit;">Docs</a>
          · <a href="https://github.com/AidanPark/byteflusher" rel="noopener" target="_blank" style="color: inherit;">GitHub</a>
          · <a href="https://github.com/AidanPark/byteflusher#-빠른-시작-사용-방법" rel="noopener" target="_blank" style="color: inherit;">Usage</a>
        </p>
      </header>

      <div class="layout">
        <aside class="sidebar">
          <section class="card">
            <div class="cardHeaderRow">
              <h2 class="sidebarTitle" style="margin: 0;">장치</h2>
            </div>
            <fieldset id="deviceFieldset">
              <div class="row">
                <button id="btnConnect" class="primary">장치 연결</button>
                <button id="btnDisconnect" disabled>연결 해제</button>
              </div>
            </fieldset>
            <div class="status">
              <div><span class="label">상태</span> <span id="statusText">연결 안 됨</span></div>
              <div class="muted small" id="detailsText"></div>
            </div>
          </section>

          <section class="card">
            <h2 class="sidebarTitle">주의사항</h2>
            <ul class="muted small" style="margin: 0; padding-left: 18px;">
              <li>본인 소유/관리 시스템 또는 명시적으로 허가받은 환경에서의 테스트/개발 자동화/데모 목적 사용을 전제로 합니다.</li>
              <li>무단 접근, 보안 우회, 비인가 입력 등 불법/비윤리적 목적으로 사용하지 마세요.</li>
              <li>OS 사전 페어링 없이, 브라우저(Chrome/Edge)에서 <b>장치 연결</b>만으로 사용합니다.</li>
              <li>시작 전 Target PC의 입력 위치(포커스)를 반드시 확인하세요.</li>
            </ul>
          </section>

          <details class="card cardCollapsible" id="settingsCardText">
            <summary class="cardSummary">
              <span class="cardSummaryTitle">전송설정</span>
            </summary>
            <fieldset id="settingsFieldset">
              <div class="grid2">
                <label class="inline" style="width: 100%; justify-content: space-between;">
                  청크 크기 (바이트)
                  <input id="chunkSize" type="number" min="1" max="200" value="20" />
                </label>
                <p class="muted small" style="margin: -2px 0 0;">
                  한 번에 BLE로 보내는 데이터 크기입니다. 너무 크면 실패율이 올라갈 수 있습니다.
                </p>
                <label class="inline" style="width: 100%; justify-content: space-between;">
                  청크 전송 간격 (ms)
                  <input id="chunkDelay" type="number" min="0" max="200" value="30" />
                </label>
                <p class="muted small" style="margin: -2px 0 0;">
                  청크를 보낸 뒤 다음 청크를 보내기 전 대기 시간입니다(전송 안정화용).
                </p>
                <label class="inline" style="width: 100%; justify-content: space-between;">
                  재시도 간격 (ms)
                  <input id="retryDelay" type="number" min="0" max="5000" value="300" />
                </label>
                <p class="muted small" style="margin: -2px 0 0;">
                  연결이 끊기거나 전송 실패 시, 재연결/재전송을 시도하기 전 대기 시간입니다.
                </p>
              </div>

              <hr class="sidebarDivider" />

              <h2 class="settingsTitle" style="margin-top: 14px;">입력설정</h2>

              <div class="grid2" style="margin-top: 12px;">
                <label class="inline" style="width: 100%; justify-content: space-between;">
                  한/영 전환키
                  <select id="toggleKey">
                    <option value="rightAlt">오른쪽 Alt (Windows)</option>
                    <option value="capsLock">Caps Lock (mac)</option>
                    <option value="leftAlt">왼쪽 Alt</option>
                    <option value="rightCtrl">오른쪽 Ctrl</option>
                    <option value="leftCtrl">왼쪽 Ctrl</option>
                    <option value="rightGui">오른쪽 GUI (Win/Cmd)</option>
                    <option value="leftGui">왼쪽 GUI (Win/Cmd)</option>
                  </select>
                </label>

                <label class="inline" style="width: 100%; justify-content: space-between;">
                  대체 문자열
                  <input id="unsupportedReplacement" type="text" value="[?]" maxlength="16" />
                </label>
                <p class="muted small" style="margin: 9px 0 0;">
                  키보드에 없는 문자는 이 문자열로 치환되어 입력됩니다.
                </p>

                <label class="inline" style="width: 100%; justify-content: space-between;">
                  라인 시작 공백/탭 무시
                  <input id="ignoreLeadingWhitespace" type="checkbox" />
                </label>
                <p class="muted small" style="margin: 9px 0 0;">
                  각 줄 맨 앞의 공백/탭은 전송하지 않습니다(IDE에 입력 후 포매팅으로 정렬할 때 유용).
                </p>

                <label class="inline" style="width: 100%; justify-content: space-between;">
                  키 입력 후 대기 (ms)
                  <input id="typingDelayMs" type="number" min="0" max="1000" value="30" />
                </label>
                <p class="muted small" style="margin: -2px 0 0;">
                  각 키 입력(문자 1개) 후 대기 시간입니다. 너무 짧으면 키 입력이 누락되거나(특히 HID/IME) 글자가 깨질 수 있습니다.
                </p>
                <label class="inline" style="width: 100%; justify-content: space-between;">
                  한/영 전환 후 대기 (ms)
                  <input id="modeSwitchDelayMs" type="number" min="0" max="3000" value="100" />
                </label>
                <p class="muted small" style="margin: -2px 0 0;">
                  한/영 전환(IME 토글) 직후 안정화 대기입니다. 전환이 완료되기 전에 다음 키를 보내면 원래 모드로 입력될 수 있습니다.
                </p>
                <label class="inline" style="width: 100%; justify-content: space-between;">
                  키 눌림 유지 (ms)
                  <input id="keyPressDelayMs" type="number" min="0" max="300" value="10" />
                </label>
                <p class="muted small" style="margin: -2px 0 0;">
                  키를 "누르고 있는 시간"입니다. 너무 짧으면 일부 환경에서 눌림이 인식되지 않을 수 있습니다.
                </p>
              </div>
              <p class="muted small" style="margin: 9px 0 0;">
                위 값들은 보드(USB HID)의 실제 타이핑 속도/안정성에 영향을 줍니다.
              </p>

              <div class="row" style="margin-top: 12px;">
                <button id="btnApplyDeviceSettings" class="primary" disabled>설정 적용</button>
                <button id="btnResetSettings">설정 초기화</button>
                <span id="textSettingsToast" class="muted small settingsToast" aria-live="polite"></span>
              </div>
            </fieldset>
          </details>

          <section class="card">
            <h2 class="sidebarTitle">참고</h2>
            <div class="muted small" style="margin: 0 0 10px 0;">
              <div style="font-weight: 600; margin-bottom: 4px;">전체 실행 절차(요약)</div>
              <div>
                텍스트 전처리(치환/공백옵션) → BLE 패킷 분할(청크) → 전송 시작(Start)
                → (선택) 장치 타이밍 설정 적용 → 청크 전송 반복(writeValue)
                → 장치(USB HID)가 실제로 타이핑 → 전송 완료(Stop/완료)
              </div>
              <div style="margin-top: 6px;">
                화면의 지표 의미: 예상/기준은 입력/설정으로 계산된 값(프리뷰 가능), 완료율은 전송된 bytes 비율 기반 근사,
                시작/경과/종료는 wall-clock 기준 표시
              </div>
            </div>
            <ul class="muted small" style="margin: 0; padding-left: 18px;">
              <li>Web Bluetooth는 Chrome/Edge에서만 동작합니다.</li>
              <li>Target PC는 USB 키보드 장치를 허용해야 합니다.</li>
              <li>시작(Flush) 전에 Target PC에서 입력될 위치에 커서를 미리 놓아주세요.</li>
              <li>시작 전에 Target PC 입력기를 <b>영문 상태</b>로 맞춰주세요(한/영 자동 동기화는 보장할 수 없습니다).</li>
              <li>BLE 전송은 길이 제한이 있어 기본적으로 분할 전송합니다.</li>
            </ul>
          </section>
        </aside>

        <section class="main">
          <section class="card">
            <label for="textInput" class="label">Flush Text</label>
            <textarea id="textInput" rows="28" placeholder="여기에 입력한 텍스트가 Target PC로 타이핑됩니다."></textarea>

            <div class="row" style="margin-top: 24px;">
              <button id="btnStart" class="primary controlButton" disabled>Start (Text)</button>
              <button id="btnPause" class="controlButton" disabled>Pause</button>
              <button id="btnResume" class="controlButton" disabled>Resume</button>
              <button id="btnStop" class="danger controlButton" disabled>Stop</button>
            </div>

            <div class="muted small" id="startHintText" style="margin-top: 8px;"></div>
            <div class="muted small" id="startChecklistText" style="margin-top: 6px; white-space: pre-wrap;"></div>

            <div id="jobMetrics" class="jobMetrics" aria-live="polite" style="margin-top: 10px;">
              <div class="jobLine">
                <span class="jobKey">예상</span>
                <span id="etaText" class="muted small">-</span>
              </div>
              <div class="jobLine">
                <span class="jobKey">시작</span>
                <span id="startTimeText" class="muted small">-</span>
              </div>
              <div class="jobLine">
                <span class="jobKey">바이트</span>
                <span id="totalBytesText" class="muted small">-</span>
              </div>
              <div class="jobLine">
                <span class="jobKey">단계</span>
                <span id="stageText" class="muted small">-</span>
              </div>
              <div class="jobLine">
                <span class="jobKey">경과</span>
                <span id="elapsedText" class="muted small">-</span>
              </div>
              <div class="jobLine">
                <span class="jobKey">완료율</span>
                <span id="progressText" class="muted small">-</span>
              </div>
              <div class="jobLine">
                <span class="jobKey">종료</span>
                <span id="endTimeText" class="muted small">-</span>
              </div>
              <div class="jobLine jobLineWide">
                <span class="jobKey">기준</span>
                <span id="estimateBasisText" class="muted small">-</span>
              </div>
            </div>

          </section>
        </section>
      </div>
    </main>

    <script type="module" src="./text.js"></script>
  </body>
</html>
