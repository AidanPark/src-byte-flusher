<!doctype html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ByteFlusher — File Flush (Windows PowerShell, Base64, SHA-256 verify)</title>
    <meta
      name="description"
      content="ByteFlusher File Flush: Web Bluetooth(BLE)로 파일/폴더를 전송하면 Target PC(Windows)에서 PowerShell로 Base64를 디코드해 파일을 생성하고 SHA-256으로 무결성 검증합니다."
    />

    <link rel="canonical" href="https://aidanpark.github.io/byteflusher/web/files.html" />

    <meta property="og:type" content="website" />
    <meta property="og:locale" content="ko_KR" />
    <meta property="og:site_name" content="ByteFlusher" />
    <meta property="og:title" content="ByteFlusher — File Flush" />
    <meta
      property="og:description"
      content="BLE 전송 → Windows PowerShell로 파일 생성(Base64 decode) + SHA-256 검증. 정확성 우선."
    />
    <meta property="og:url" content="https://aidanpark.github.io/byteflusher/web/files.html" />
    <meta property="og:image" content="https://aidanpark.github.io/byteflusher/docs/ui_files_preview.svg" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="ByteFlusher — File Flush" />
    <meta
      name="twitter:description"
      content="Windows PowerShell 기반 파일 생성/검증(Base64 decode + SHA-256). BLE(Web Bluetooth)로 전송."
    />
    <meta name="twitter:image" content="https://aidanpark.github.io/byteflusher/docs/ui_files_preview.svg" />

    <link rel="stylesheet" href="./style.css" />
  </head>
  <body>
    <main class="container">
      <header class="topHeader">
        <h1><a href="../index.html" style="color: inherit; text-decoration: none;">🤖 Byte Flusher - File 📁</a></h1>
        <p class="muted" style="margin-top: 8px; font-size: 14px; line-height: 1.5;">
          <a href="../index.html" style="color: inherit;">Home</a>
          · <a href="./text.html" style="color: inherit;">Text Flush</a>
          · <a href="https://github.com/AidanPark/byteflusher" rel="noopener" target="_blank" style="color: inherit;">GitHub</a>
          · <a href="https://github.com/AidanPark/byteflusher#-빠른-시작-사용-방법" rel="noopener" target="_blank" style="color: inherit;">Usage/Docs</a>
        </p>
      </header>

      <div class="layout">
        <aside class="sidebar">
          <section class="card">
            <h2 class="sidebarTitle">장치</h2>
            <fieldset id="deviceFieldset">
              <div class="row">
                <button id="btnConnect" class="primary">장치 연결</button>
                <button id="btnDisconnect" disabled>연결 해제</button>
              </div>
            </fieldset>
            <div class="status">
              <div><span class="label">상태</span> <span id="statusText">연결 안 됨</span></div>
              <div class="muted small" id="detailsText"></div>
            </div>
          </section>

          <section class="card">
            <h2 class="sidebarTitle">주의사항(중요)</h2>
            <ul class="muted small" style="margin: 0; padding-left: 18px;">
              <li><b>허가된 환경 전용:</b> 본인 소유/관리 시스템 또는 명시적으로 허가받은 환경에서의 테스트/개발 자동화/데모 목적 사용을 전제로 합니다.</li>
              <li>무단 접근, 보안 우회, 비인가 파일 생성/입력 등 불법/비윤리적 목적으로 사용하지 마세요.</li>
              <li>Target directory: 절대경로 / 영문(ASCII)만 / 공백 불가</li>
              <li>입력: 최상위 폴더 1개 또는 파일 1개</li>
              <li>내용: 바이트 그대로 보존(Base64 → WriteAllBytes)</li>
              <li>PowerShell: Win+R로 자동 실행(포커스/팝업/UAC/IME에 취약)</li>
              <li>사람이 안 건드려도 Windows 알림/백신/업데이트/UAC 등 시스템 UI가 포커스를 뺏으면 실패할 수 있음</li>
              <li>권장: 화면보호기/자동잠금/절전 OFF, 알림 OFF, 작업 중 마우스/키보드 조작 금지</li>
              <li>권장: 권한 문제를 피하려면 사용자 폴더 아래 경로 사용(예: C:\Users\me\...)</li>
            </ul>
          </section>

          <section class="card">
            <h2 class="sidebarTitle">설정</h2>
            <fieldset id="settingsFieldset">
              <h2 class="settingsTitle" style="margin-top: 0;">전송설정</h2>
              <div class="grid2">
                <label class="inline" style="width: 100%; justify-content: space-between;">
                  Key 입력 후 대기 (ms)
                  <input id="keyDelayMsFiles" type="number" min="0" max="120" step="1" value="10" />
                </label>
                <p class="muted small" style="margin: -2px 0 0;">
                  문자 1개 입력 후 대기 시간입니다. 너무 짧으면 콘솔/IME 환경에서 누락될 수 있습니다.
                </p>

                <label class="inline" style="width: 100%; justify-content: space-between;">
                  Line(Enter) 후 대기 (ms)
                  <input id="lineDelayMsFiles" type="number" min="0" max="2000" step="1" value="20" />
                </label>
                <p class="muted small" style="margin: -2px 0 0;">
                  Enter 입력 직후 안정화 대기입니다. 명령 처리/화면 갱신이 느린 환경에서 도움됩니다.
                </p>

                <label class="inline" style="width: 100%; justify-content: space-between;">
                  명령 간 대기 (ms)
                  <input id="commandDelayMsFiles" type="number" min="0" max="4000" step="5" value="50" />
                </label>
                <p class="muted small" style="margin: -2px 0 0;">
                  PowerShell 명령(한 줄) 실행 후 다음 명령으로 넘어가기 전 대기입니다(청크 반복 시 중요).
                </p>
              </div>

              <hr class="sidebarDivider" />

              <h2 class="settingsTitle" style="margin-top: 14px;">Base64 / 청크설정</h2>
              <div class="grid2" style="margin-top: 12px;">
                <label class="inline" style="width: 100%; justify-content: space-between;">
                  청크 길이 (Chars)
                  <input id="chunkCharsFiles" type="number" min="200" max="4000" step="50" value="1200" />
                </label>
                <p class="muted small" style="margin: -2px 0 0;">
                  Base64 문자열을 몇 글자 단위로 나눌지 결정합니다. 길수록 빠르지만 누락/오류 위험이 커집니다.
                </p>

                <label class="inline" style="width: 100%; justify-content: space-between;">
                  청크 사이 대기 (ms)
                  <input id="chunkDelayMsFiles" type="number" min="0" max="2000" step="5" value="20" />
                </label>
                <p class="muted small" style="margin: -2px 0 0;">
                  청크 1개를 보낸 뒤 다음 청크를 보내기 전 대기입니다(입력/처리 안정화용).
                </p>
              </div>

              <hr class="sidebarDivider" />

              <h2 class="settingsTitle" style="margin-top: 14px;">쓰기설정</h2>
              <div class="grid2" style="margin-top: 12px;">
                <label class="inline" style="width: 100%; justify-content: space-between;">
                  Overwrite 정책
                  <select id="overwritePolicyFiles">
                    <option value="fail" selected>fail (권장)</option>
                    <option value="overwrite">overwrite</option>
                    <option value="backup">backup (.bak)</option>
                  </select>
                </label>
                <p class="muted small" style="margin: -2px 0 0;">
                  대상 파일이 이미 존재할 때 동작입니다. 기본은 fail로 두고, 필요 시에만 overwrite/backup을 사용하세요.
                </p>
              </div>

              <hr class="sidebarDivider" />

              <h2 class="settingsTitle" style="margin-top: 14px;">자동화/부트스트랩</h2>
              <div class="grid2" style="margin-top: 12px;">
                <label class="inline" style="width: 100%; justify-content: space-between;">
                  Run(Win+R) 열기 후 대기 (ms)
                  <input id="runDialogDelayMsFiles" type="number" min="100" max="2000" step="10" value="250" />
                </label>
                <p class="muted small" style="margin: -2px 0 0;">
                  Win+R 입력 후 Run 창이 완전히 포커스를 잡을 때까지 기다립니다.
                </p>

                <label class="inline" style="width: 100%; justify-content: space-between;">
                  PowerShell 실행 후 대기 (ms)
                  <input id="psLaunchDelayMsFiles" type="number" min="1200" max="8000" step="50" value="1200" />
                </label>
                <p class="muted small" style="margin: -2px 0 0;">
                  PowerShell이 뜨고 프롬프트가 입력 가능한 상태가 될 때까지 기다립니다.
                </p>

                <label class="inline" style="width: 100%; justify-content: space-between;">
                  부트스트랩 후 대기 (ms)
                  <input id="bootstrapDelayMsFiles" type="number" min="200" max="3000" step="10" value="200" />
                </label>
                <p class="muted small" style="margin: -2px 0 0;">
                  부트스트랩 스크립트 초기화 후 다음 명령으로 넘어가기 전 안정화 대기입니다.
                </p>

                <label class="inline" style="width: 100%; justify-content: space-between;">
                  진단 로그 남기기
                  <input id="diagLogFiles" type="checkbox" checked />
                </label>
                <p class="muted small" style="margin: -2px 0 0;">
                  실패 시 targetDir\.tmp\bf_last_error.txt 에 오류 로그를 기록합니다.
                </p>
              </div>

              <div class="row" style="margin-top: 12px;">
                <button id="btnApplyFilesSettings" class="primary" type="button">설정 적용</button>
                <button id="btnResetFilesSettings" type="button">설정 초기화</button>
                <span id="filesSettingsToast" class="muted small settingsToast" aria-live="polite"></span>
              </div>
            </fieldset>
          </section>

          <section class="card">
            <h2 class="sidebarTitle">참고</h2>
            <div class="muted small" style="margin: 0 0 10px 0;">
              <div style="font-weight: 600; margin-bottom: 4px;">전체 실행 절차(요약)</div>
              <div>
                PowerShell 실행(Win+R) → 콘솔 워밍업/BF_READY → 런처 설치(bf_boot_append/run) → 부트스트랩 전송(bf_boot_append…)
                → 부트스트랩 실행(bf_boot_run) → 파일 반복(prepare_out → tmp_reset → tmp_append… → commit)
                → 디코드(WriteAllBytes) → SHA-256 검증(Get-FileHash) → 정리(.tmp 삭제) → 완료
              </div>
              <div style="margin-top: 6px;">
                화면의 단계 표시 매핑: 준비(Win+R/워밍업/BF_READY) → 부트(런처+부트스트랩 설치) → 전송(Base64 청크 입력)
                → 복원(WriteAllBytes) → 검증(Get-FileHash) → 정리(임시파일 삭제)
              </div>
            </div>
            <ul class="muted small" style="margin: 0; padding-left: 18px;">
              <li>Web Bluetooth는 Chrome/Edge에서만 동작합니다.</li>
              <li>Target PC는 USB 키보드 장치를 허용해야 합니다.</li>
              <li>검증은 SHA-256 필수이며, 불일치 시 즉시 중단합니다.</li>
              <li>임시 Base64 파일은 targetDir\\.tmp\\bf_payload_&lt;auto&gt;.b64 로 자동 생성되며, 시작 전에 기존 임시파일을 삭제합니다.</li>
              <li>targetDir가 존재하지 않으면 자동으로 폴더를 생성합니다.</li>
              <li>보안 정책/쓰기 권한에 따라 실패할 수 있습니다.</li>
              <li>진단 로그 옵션이 켜져 있으면 실패 시 targetDir\\.tmp\\bf_last_error.txt 가 생성될 수 있습니다.</li>
            </ul>
          </section>
        </aside>

        <section class="main">
          <section class="card">
            <h2 class="settingsTitle" style="margin-top: 0;">Windows: 다중 파일 생성</h2>
            <p class="muted small" style="margin-top: 6px;">
              파일 1개 또는 폴더 1개를 선택하면, 선택한 구조 그대로 Target PC의 targetDir 아래에 파일을 생성합니다.
              각 파일은 생성 후 SHA-256으로 무결성 검증을 수행하며, 불일치/실패가 발생하면 즉시 중단하고 오류로 표시합니다.
              실행이 "완료"로 끝나고, 추가로 생성된 오류 리포트(targetDir\.tmp\bf_last_error.txt)가 없다면 생성된 파일은 오류가 없다고 보면 됩니다.
            </p>

            <div class="grid2" style="margin-top: 12px;">
              <h2 class="settingsTitle" style="margin: 0; padding-top: 14px;">소스 선택</h2>
              <p class="muted small" style="margin: -2px 0 0;">
                Target PC에 <b>생성/입력할 파일(또는 폴더)</b>을 선택하세요.
              </p>

              <div class="row">
                <button id="btnPickFile" type="button" class="controlButton">파일 선택</button>
                <button id="btnPickFolder" type="button" class="controlButton">폴더 선택</button>

                <!-- 숨김 입력: 버튼으로만 트리거한다 -->
                <input id="fileInput" type="file" style="display: none;" />
                <input id="folderInput" type="file" webkitdirectory multiple style="display: none;" />
              </div>

              <div class="muted small" style="margin-top: 4px;">
                <div><span class="label">선택된 항목</span> <span id="filesSummary">-</span></div>
                <div class="muted small" id="filesDetails" style="margin-top: 4px; white-space: pre-wrap;"></div>
              </div>

              <h2 class="settingsTitle" style="margin: 0; padding-top: 18px;">타겟 시스템 선택</h2>
              <div class="row" id="targetSystemRow">
                <label class="controlOption">
                  <input type="radio" name="targetSystem" value="windows" checked />
                  Windows
                </label>
                <label class="controlOption">
                  <input type="radio" name="targetSystem" value="mac" disabled />
                  macOS (준비중)
                </label>
                <label class="controlOption">
                  <input type="radio" name="targetSystem" value="linux" disabled />
                  Linux (준비중)
                </label>
              </div>

              <h2 class="settingsTitle" style="margin: 0; padding-top: 18px;">타겟 디렉토리 선택</h2>
              <p class="muted small" style="margin: -2px 0 0;">
                Target PC에 파일을 생성/입력할 <b>디렉토리</b>를 입력하세요.
              </p>
              <input id="targetDir" class="textField" type="text" value="C:\\byteflusher" placeholder="예: C:\\Users\\me\\Documents\\byteflusher_out" />
              <div id="targetDirValidityFiles" class="muted small validityLine" aria-live="polite"></div>
              <p class="muted small" style="margin: -2px 0 0;">
                영문(ASCII)만, 공백 불가. (권한 문제를 피하려면 사용자 폴더 하위 권장)
              </p>
            </div>

            <div class="row" style="margin-top: 24px;">
              <button id="btnStartFiles" class="primary controlButton" disabled>Start (Files)</button>
              <button id="btnPauseFiles" class="controlButton" disabled>Pause</button>
              <button id="btnResumeFiles" class="controlButton" disabled>Resume</button>
              <button id="btnStopFiles" class="danger controlButton" disabled>Stop</button>
            </div>

            <div class="muted small" id="startHint" style="margin-top: 8px;"></div>
            <div class="muted small" id="startChecklistFiles" style="margin-top: 6px; white-space: pre-wrap;"></div>

            <div id="jobMetricsFiles" class="jobMetrics" aria-live="polite" style="margin-top: 10px;">
              <div class="jobLine">
                <span class="jobKey">예상</span>
                <span id="etaTextFiles" class="muted small">-</span>
              </div>
              <div class="jobLine">
                <span class="jobKey">시작</span>
                <span id="startTimeTextFiles" class="muted small">-</span>
              </div>
              <div class="jobLine">
                <span class="jobKey">파일</span>
                <span id="fileCountTextFiles" class="muted small">-</span>
              </div>
              <div class="jobLine">
                <span class="jobKey">바이트</span>
                <span id="totalBytesTextFiles" class="muted small">-</span>
              </div>
              <div class="jobLine">
                <span class="jobKey">단계</span>
                <span id="stageTextFiles" class="muted small">-</span>
              </div>
              <div class="jobLine">
                <span class="jobKey">경과</span>
                <span id="elapsedTextFiles" class="muted small">-</span>
              </div>
              <div class="jobLine">
                <span class="jobKey">완료율</span>
                <span id="progressTextFiles" class="muted small">-</span>
              </div>
              <div class="jobLine">
                <span class="jobKey">종료</span>
                <span id="endTimeTextFiles" class="muted small">-</span>
              </div>
              <div class="jobLine jobLineWide">
                <span class="jobKey">기준</span>
                <span id="estimateBasisTextFiles" class="muted small">-</span>
              </div>
            </div>
          </section>
        </section>
      </div>
    </main>

    <script type="module" src="./files.js"></script>
  </body>
</html>
