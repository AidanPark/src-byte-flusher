<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ByteFlusher ‚Äî File Flush (Windows PowerShell, Base64, SHA-256 verify)</title>
    <meta
      name="description"
      content="ByteFlusher File Flush: Send files/folders via Web Bluetooth (BLE) and the Target PC (Windows) decodes Base64 via PowerShell and verifies integrity with SHA-256."
    />

    <link rel="icon" href="../favicon.svg" type="image/svg+xml" />
    <link rel="icon" href="../favicon.svg" sizes="any" />

    <link rel="canonical" href="https://aidanpark.github.io/byteflusher/web/files.html" />

    <meta property="og:type" content="website" />
    <meta property="og:locale" content="en_US" />
    <meta property="og:site_name" content="ByteFlusher" />
    <meta property="og:title" content="ByteFlusher ‚Äî File Flush" />
    <meta
      property="og:description"
      content="BLE transfer ‚Üí Windows PowerShell file creation (Base64 decode) + SHA-256 verification. Accuracy-first."
    />
    <meta property="og:url" content="https://aidanpark.github.io/byteflusher/web/files.html" />
    <meta property="og:image" content="https://aidanpark.github.io/byteflusher/docs/ui_files_preview.png" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="ByteFlusher ‚Äî File Flush" />
    <meta
      name="twitter:description"
      content="Windows PowerShell file creation/verification (Base64 decode + SHA-256). Sent via BLE (Web Bluetooth)."
    />
    <meta name="twitter:image" content="https://aidanpark.github.io/byteflusher/docs/ui_files_preview.png" />

    <link rel="stylesheet" href="./style.css" />
  </head>
  <body>
    <main class="container">
      <header class="topHeader">
        <h1><a href="../index.html" style="color: inherit; text-decoration: none;">ü§ñ Byte Flusher - File üìÅ</a></h1>
        <p class="muted" style="margin-top: 8px; font-size: 14px; line-height: 1.5;">
          <a href="../index.html" style="color: inherit;">Home</a>
          ¬∑ <a href="./text.html" style="color: inherit;">Text Flush</a>
          ¬∑ <a href="../docs/" style="color: inherit;">Docs</a>
          ¬∑ <a href="https://github.com/AidanPark/byteflusher" rel="noopener" target="_blank" style="color: inherit;">GitHub</a>
          ¬∑ <a href="https://github.com/AidanPark/byteflusher#-Îπ†Î•∏-ÏãúÏûë-ÏÇ¨Ïö©-Î∞©Î≤ï" rel="noopener" target="_blank" style="color: inherit;">Usage</a>
        </p>
      </header>

      <div class="layout">
        <aside class="sidebar">
          <section class="card">
            <div class="cardHeaderRow">
              <h2 class="sidebarTitle" style="margin: 0;" data-i18n="common.device">Device</h2>
            </div>
            <fieldset id="deviceFieldset">
              <div class="row">
                <button id="btnConnect" class="primary" data-i18n="common.connect">Connect Device</button>
                <button id="btnDisconnect" disabled data-i18n="common.disconnect">Disconnect</button>
                <button id="btnBootloader" class="danger" disabled data-i18n="common.bootloader">Enter Bootloader</button>
              </div>

              <div class="grid2" style="margin-top: 10px;">
                <label class="inline" style="width: 100%; justify-content: space-between;">
                  <span data-i18n="common.nickname">Nickname</span>
                  <input id="deviceNickname" class="textField" type="text" maxlength="12" placeholder="e.g. team1" data-i18n-placeholder="common.nicknamePlaceholderFiles" />
                </label>
                <p class="muted small" style="margin: -2px 0 0;" data-i18n="common.nicknameHint">
                  Saved to board; reflected in advertising name (alphanumeric/-/_).
                </p>
              </div>

              <div class="row" style="margin-top: 8px;">
                <button id="btnApplyNickname" type="button" disabled data-i18n="common.saveNickname">Save Nickname</button>
              </div>
            </fieldset>
            <div class="status">
              <div><span class="label" data-i18n="common.status">Status</span> <span id="statusText" data-i18n="status.disconnected">Disconnected</span></div>
              <div class="muted small" id="detailsText"></div>
            </div>
          </section>

          <section class="card">
            <h2 class="sidebarTitle" data-i18n="common.cautions">Cautions</h2>
            <ul class="muted small" style="margin: 0; padding-left: 18px;">
              <li data-i18n-html="files.cautionAuthBold"><b>Authorized environments only:</b> Intended for testing/development automation/demo purposes on systems you own/manage or in explicitly authorized environments.</li>
              <li data-i18n="files.cautionIllegalFiles">Do not use for unauthorized access, security bypass, unauthorized file creation/input, or any illegal/unethical purpose.</li>
              <li data-i18n-html="common.cautionNoPairing">No OS pre-pairing needed; just use <b>Connect Device</b> from the browser (Chrome/Edge).</li>
              <li data-i18n="files.cautionTargetDir">Target directory: absolute path / ASCII only / no spaces</li>
              <li data-i18n="files.cautionInput">Input: one top-level folder or one file</li>
              <li data-i18n="files.cautionContent">Content: bytes preserved as-is (Base64 ‚Üí WriteAllBytes)</li>
              <li data-i18n="files.cautionPowerShell">PowerShell: auto-launched via Win+R (vulnerable to focus/popup/UAC/IME)</li>
              <li data-i18n="files.cautionFocusSteal">Even without user interaction, system UI (notifications/antivirus/updates/UAC) can steal focus and cause failure</li>
              <li data-i18n="files.cautionRecommend">Recommended: screen saver/auto-lock/sleep OFF, notifications OFF, no mouse/keyboard use during operation</li>
              <li data-i18n="files.cautionUserFolder">Recommended: use a path under user folder to avoid permission issues (e.g. C:\Users\me\...)</li>
            </ul>
          </section>

          <details class="card cardCollapsible" id="settingsCardFiles">
            <summary class="cardSummary">
              <span class="cardSummaryTitle" data-i18n="common.transferSettings">Transfer Settings</span>
            </summary>
            <fieldset id="settingsFieldset">
              <div class="grid2">
                <label class="inline" style="width: 100%; justify-content: space-between;">
                  <span data-i18n="files.settingsTypingDelay">Typing delay (ms)</span>
                  <input id="typingDelayMsFiles" type="number" min="2" max="1000" step="1" value="3" />
                </label>
                <p class="muted small" style="margin: -2px 0 0;" data-i18n="files.settingsTypingDelayHint">
                  Wait time after each keystroke. Too short may cause drops in console/IME environments. (Aggressive tuning possible: 0~)
                </p>

                <label class="inline" style="width: 100%; justify-content: space-between;">
                  <span data-i18n="files.settingsKeyPressDelay">Key press hold (ms)</span>
                  <input id="keyPressDelayMsFiles" type="number" min="2" max="300" step="1" value="3" />
                </label>
                <p class="muted small" style="margin: -2px 0 0;" data-i18n="files.settingsKeyPressDelayHint">
                  How long a key is held down. Too short may not register in some environments.
                </p>

                <label class="inline" style="width: 100%; justify-content: space-between;">
                  <span data-i18n="files.settingsLineDelay">Line (Enter) delay (ms)</span>
                  <input id="lineDelayMsFiles" type="number" min="0" max="2000" step="1" value="20" />
                </label>
                <p class="muted small" style="margin: -2px 0 0;" data-i18n="files.settingsLineDelayHint">
                  Stabilization wait after Enter. Helps in environments with slow command processing/screen refresh.
                </p>

                <label class="inline" style="width: 100%; justify-content: space-between;">
                  <span data-i18n="files.settingsCommandDelay">Command interval (ms)</span>
                  <input id="commandDelayMsFiles" type="number" min="0" max="4000" step="5" value="50" />
                </label>
                <p class="muted small" style="margin: -2px 0 0;" data-i18n="files.settingsCommandDelayHint">
                  Wait after a PowerShell command (one line) before the next (important for chunk loops).
                </p>
              </div>

              <hr class="sidebarDivider" />

              <h2 class="settingsTitle" style="margin-top: 14px;" data-i18n="files.settingsBase64ChunkTitle">Base64 / Chunk Settings</h2>
              <div class="grid2" style="margin-top: 12px;">
                <label class="inline" style="width: 100%; justify-content: space-between;">
                  <span data-i18n="files.settingsBootChunkChars">Bootstrap chunk length (Chars)</span>
                  <input id="bootChunkCharsFiles" type="number" min="200" max="4000" step="50" value="2000" />
                </label>
                <p class="muted small" style="margin: -2px 0 0;" data-i18n="files.settingsBootChunkCharsHint">
                  Determines how many characters per bf_boot_append chunk (bootstrap -EncodedCommand Base64). Longer is faster but increases risk of keystroke drops.
                </p>

                <label class="inline" style="width: 100%; justify-content: space-between;">
                  <span data-i18n="files.settingsChunkChars">Chunk length (Chars)</span>
                  <input id="chunkCharsFiles" type="number" min="1000" max="10000" step="50" value="5000" />
                </label>
                <p class="muted small" style="margin: -2px 0 0;" data-i18n="files.settingsChunkCharsHint">
                  Determines how many characters per Base64 chunk. Longer is faster but increases error/drop risk.
                </p>

                <label class="inline" style="width: 100%; justify-content: space-between;">
                  <span data-i18n="files.settingsChunkDelay">Inter-chunk delay (ms)</span>
                  <input id="chunkDelayMsFiles" type="number" min="0" max="2000" step="5" value="20" />
                </label>
                <p class="muted small" style="margin: -2px 0 0;" data-i18n="files.settingsChunkDelayHint">
                  Wait after sending one chunk before the next (for input/processing stabilization).
                </p>
              </div>

              <hr class="sidebarDivider" />

              <h2 class="settingsTitle" style="margin-top: 14px;" data-i18n="files.settingsWriteTitle">Write Settings</h2>
              <div class="grid2" style="margin-top: 12px;">
                <label class="inline" style="width: 100%; justify-content: space-between;">
                  <span data-i18n="files.overwritePolicy">Overwrite Policy</span>
                  <select id="overwritePolicyFiles">
                    <option value="fail" selected data-i18n="files.overwriteFail">fail (recommended)</option>
                    <option value="overwrite" data-i18n="files.overwriteOverwrite">overwrite</option>
                    <option value="backup" data-i18n="files.overwriteBackup">backup (.bak)</option>
                  </select>
                </label>
                <p class="muted small" style="margin: -2px 0 0;" data-i18n="files.overwritePolicyHint">
                  Behavior when a target file already exists. Keep 'fail' by default; use overwrite/backup only when needed.
                </p>
              </div>

              <hr class="sidebarDivider" />

              <h2 class="settingsTitle" style="margin-top: 14px;" data-i18n="files.settingsAutomationTitle">Automation / Bootstrap</h2>
              <div class="grid2" style="margin-top: 12px;">
                <label class="inline" style="width: 100%; justify-content: space-between;">
                  <span data-i18n="files.settingsRunDialogDelay">Run (Win+R) dialog delay (ms)</span>
                  <input id="runDialogDelayMsFiles" type="number" min="100" max="4000" step="10" value="350" />
                </label>
                <p class="muted small" style="margin: -2px 0 0;" data-i18n="files.settingsRunDialogDelayHint">
                  Wait for the Run dialog to fully gain focus after Win+R.
                </p>

                <label class="inline" style="width: 100%; justify-content: space-between;">
                  <span data-i18n="files.settingsPsLaunchDelay">PowerShell launch delay (ms)</span>
                  <input id="psLaunchDelayMsFiles" type="number" min="1200" max="20000" step="50" value="9000" />
                </label>
                <p class="muted small" style="margin: -2px 0 0;" data-i18n="files.settingsPsLaunchDelayHint">
                  Wait for PowerShell to open and the prompt to become ready for input.
                </p>

                <label class="inline" style="width: 100%; justify-content: space-between;">
                  <span data-i18n="files.settingsBootstrapDelay">Post-bootstrap delay (ms)</span>
                  <input id="bootstrapDelayMsFiles" type="number" min="200" max="10000" step="10" value="800" />
                </label>
                <p class="muted small" style="margin: -2px 0 0;" data-i18n="files.settingsBootstrapDelayHint">
                  Stabilization wait after bootstrap script initialization before continuing.
                </p>

                <label class="inline" style="width: 100%; justify-content: space-between;">
                  <span data-i18n="files.settingsDiagLog">Enable diagnostic logging</span>
                  <input id="diagLogFiles" type="checkbox" checked />
                </label>
                <p class="muted small" style="margin: -2px 0 0;" data-i18n="files.settingsDiagLogHint">
                  On failure, writes error log to targetDir\.tmp\bf_last_error.txt.
                </p>
              </div>

              <div class="row" style="margin-top: 12px;">
                <button id="btnApplyFilesSettings" class="primary" type="button" data-i18n="common.applySettings">Apply Settings</button>
                <button id="btnResetFilesSettings" type="button" data-i18n="common.resetSettings">Reset Settings</button>
                <span id="filesSettingsToast" class="muted small settingsToast" aria-live="polite"></span>
              </div>
            </fieldset>
          </details>

          <section class="card">
            <h2 class="sidebarTitle" data-i18n="common.notes">Notes</h2>
            <div class="muted small" style="margin: 0 0 10px 0;">
              <div style="font-weight: 600; margin-bottom: 4px;" data-i18n="files.procedureSummaryTitle">Execution procedure (summary)</div>
              <div data-i18n="files.procedureSummary">
                PowerShell launch (Win+R) ‚Üí console warmup/BF_READY ‚Üí launcher install (bf_boot_append/run) ‚Üí bootstrap send (bf_boot_append‚Ä¶) ‚Üí bootstrap execute (bf_boot_run) ‚Üí file loop (prepare_out ‚Üí tmp_reset ‚Üí tmp_append‚Ä¶ ‚Üí commit) ‚Üí decode (WriteAllBytes) ‚Üí SHA-256 verify (Get-FileHash) ‚Üí cleanup (.tmp delete) ‚Üí done
              </div>
              <div style="margin-top: 6px;" data-i18n="files.stageMapping">
                Stage display mapping: Prepare (Win+R/warmup/BF_READY) ‚Üí Boot (launcher+bootstrap install) ‚Üí Send (Base64 chunk input) ‚Üí Decode (WriteAllBytes) ‚Üí Verify (Get-FileHash) ‚Üí Cleanup (temp file delete)
              </div>
            </div>
            <ul class="muted small" style="margin: 0; padding-left: 18px;">
              <li data-i18n="text.noteBluetooth">Web Bluetooth only works in Chrome/Edge.</li>
              <li data-i18n="text.noteUSB">Target PC must allow USB keyboard devices.</li>
              <li data-i18n="files.noteVerify">Verification uses SHA-256; mismatches stop immediately.</li>
              <li data-i18n="files.noteTempFiles">Temporary Base64 files are auto-created as targetDir\.tmp\bf_payload_&lt;auto&gt;.b64; existing temp files are deleted before start.</li>
              <li data-i18n="files.noteAutoDir">If targetDir does not exist, folders are created automatically.</li>
              <li data-i18n="files.notePermission">May fail depending on security policy/write permissions.</li>
              <li data-i18n="files.noteDiagLog">When diagnostic logging is enabled, targetDir\.tmp\bf_last_error.txt may be created on failure.</li>
            </ul>
          </section>
        </aside>

        <section class="main">
          <section class="card">
            <h2 class="settingsTitle" style="margin-top: 0;" data-i18n="files.multiFileTitle">Multi-file Creation</h2>
            <p class="muted small" style="margin-top: 6px;" data-i18n="files.multiFileDesc">
              Select a single file or folder to create files on the Target PC under targetDir, preserving the selected structure. Each file is verified with SHA-256 after creation; mismatches/failures stop immediately with an error. If the run completes and no error report (targetDir\.tmp\bf_last_error.txt) is generated, the created files are error-free.
            </p>

            <div class="grid2" style="margin-top: 12px;">
              <h2 class="settingsTitle" style="margin: 0; padding-top: 14px;" data-i18n="files.sourceSelect">Source Selection</h2>
              <p class="muted small" style="margin: -2px 0 0;" data-i18n-html="files.sourceSelectHint">
                Select <b>file(s) or folder</b> to create on the Target PC.
              </p>

              <div class="row">
                <button id="btnPickFile" type="button" class="controlButton" data-i18n="files.selectFile">Select File</button>
                <button id="btnPickFolder" type="button" class="controlButton" data-i18n="files.selectFolder">Select Folder</button>

                <!-- Hidden inputs: triggered by buttons only -->
                <input id="fileInput" type="file" style="display: none;" />
                <input id="folderInput" type="file" webkitdirectory multiple style="display: none;" />
              </div>

              <div class="muted small" style="margin-top: 4px;">
                <div><span class="label" data-i18n="files.selectedItems">Selected items</span> <span id="filesSummary">-</span></div>
                <div class="muted small" id="filesDetails" style="margin-top: 4px; white-space: pre-wrap;"></div>
              </div>

              <h2 class="settingsTitle" style="margin: 0; padding-top: 18px;" data-i18n="files.targetSystemSelect">Target System</h2>
              <div class="row" id="targetSystemRow">
                <label class="controlOption">
                  <input type="radio" name="targetSystem" value="windows" checked />
                  <span data-i18n="files.targetSystemWindows">Windows</span>
                </label>
                <label class="controlOption">
                  <input type="radio" name="targetSystem" value="mac" disabled />
                  <span data-i18n="files.macOSComingSoon">macOS (coming soon)</span>
                </label>
                <label class="controlOption">
                  <input type="radio" name="targetSystem" value="linux" disabled />
                  <span data-i18n="files.linuxComingSoon">Linux (coming soon)</span>
                </label>
              </div>

              <h2 class="settingsTitle" style="margin: 0; padding-top: 18px;" data-i18n="files.targetDirSelect">Target Directory</h2>
              <p class="muted small" style="margin: -2px 0 0;" data-i18n-html="files.targetDirHint">
                Enter the <b>directory</b> on the Target PC where files will be created.
              </p>
              <input id="targetDir" class="textField" type="text" value="C:\\byteflusher" placeholder="e.g. C:\\Users\\me\\Documents\\byteflusher_out" data-i18n-placeholder="files.targetDirPlaceholder" />
              <div id="targetDirValidityFiles" class="muted small validityLine" aria-live="polite"></div>
              <p class="muted small" style="margin: -2px 0 0;" data-i18n="files.targetDirAsciiHint">
                ASCII only, no spaces. (Recommended: use a path under user folder to avoid permission issues)
              </p>
            </div>

            <div class="row" style="margin-top: 24px;">
              <button id="btnStartFiles" class="primary controlButton" disabled data-i18n="common.startFiles">Start (Files)</button>
              <button id="btnPauseFiles" class="controlButton" disabled data-i18n="common.pause">Pause</button>
              <button id="btnResumeFiles" class="controlButton" disabled data-i18n="common.resume">Resume</button>
              <button id="btnStopFiles" class="danger controlButton" disabled data-i18n="common.stop">Stop</button>
            </div>

            <div class="muted small" id="startHint" style="margin-top: 8px;"></div>
            <div class="muted small" id="startChecklistFiles" style="margin-top: 6px; white-space: pre-wrap;"></div>

            <div id="jobMetricsFiles" class="jobMetrics" aria-live="polite" style="margin-top: 10px;">
              <div class="jobLine">
                <span class="jobKey" data-i18n="metric.estimate">ETA</span>
                <span id="etaTextFiles" class="muted small">-</span>
              </div>
              <div class="jobLine">
                <span class="jobKey" data-i18n="metric.startTime">Start</span>
                <span id="startTimeTextFiles" class="muted small">-</span>
              </div>
              <div class="jobLine">
                <span class="jobKey" data-i18n="metric.files">Files</span>
                <span id="fileCountTextFiles" class="muted small">-</span>
              </div>
              <div class="jobLine">
                <span class="jobKey" data-i18n="metric.bytes">Bytes</span>
                <span id="totalBytesTextFiles" class="muted small">-</span>
              </div>
              <div class="jobLine">
                <span class="jobKey" data-i18n="metric.stage">Stage</span>
                <span id="stageTextFiles" class="muted small">-</span>
              </div>
              <div class="jobLine">
                <span class="jobKey" data-i18n="metric.elapsed">Elapsed</span>
                <span id="elapsedTextFiles" class="muted small">-</span>
              </div>
              <div class="jobLine">
                <span class="jobKey" data-i18n="metric.progress">Progress</span>
                <span id="progressTextFiles" class="muted small">-</span>
              </div>
              <div class="jobLine">
                <span class="jobKey" data-i18n="metric.endTime">End</span>
                <span id="endTimeTextFiles" class="muted small">-</span>
              </div>
              <div class="jobLine jobLineWide">
                <span class="jobKey" data-i18n="metric.basis">Basis</span>
                <span id="estimateBasisTextFiles" class="muted small">-</span>
              </div>
            </div>

          </section>
        </section>
      </div>
    </main>

    <script type="module" src="./files.js"></script>
  </body>
</html>
